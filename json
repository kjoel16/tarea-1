package com.mycompany.api.transaccions.controller;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.mycompany.api.transaccions.dto.*;
import com.mycompany.api.transaccions.service.TransaccionService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/api/transaccion")
public class TransaccionController {

    @Autowired
    private TransaccionService service;

    @PostMapping
    public ResponseDTO ejecutar(@RequestBody RequestDTO request) throws Exception {

        TransaccionDataDTO data =
                new ObjectMapper().convertValue(request.getData(), TransaccionDataDTO.class);

        TransaccionResultDTO result = service.ejecutar(data);

        HeaderResponseDTO header = new HeaderResponseDTO();
        header.setCodigo(result.getCodErr());
        header.setMensaje(result.getDescErr());

        ResponseDTO response = new ResponseDTO();
        response.setHeader(header);
        response.setData(result);

        return response;
    }
}
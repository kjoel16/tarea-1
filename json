CREATE OR REPLACE PROCEDURE KJOELQDD.SP_DATOS_CLIENTE_CUENTA (
    IN  P_CUENTA CHAR(20),

    OUT P_DMSTAT CHAR(2),
    OUT P_CUNBR  CHAR(15),
    OUT P_CUNA1  VARCHAR(60),
    OUT P_CUCLPH VARCHAR(20),
    OUT P_CUNTID VARCHAR(20),
    OUT P_CUEMA1 VARCHAR(60)
)
LANGUAGE SQL
BEGIN

    DECLARE V_CIFMMM CHAR(15);

    -- 1) Obtener CIFMMM desde la cuenta
    SELECT CIFMMM
    INTO V_CIFMMM
    FROM KJOELQDD.CUP00901
    WHERE TRIM(ACCOUM) = TRIM(P_CUENTA)
    FETCH FIRST 1 ROW ONLY;

    -- 2) Obtener estado de la cuenta
    SELECT DMSTAT
    INTO P_DMSTAT
    FROM KJOELQDD.TAP00201
    WHERE TRIM(ACCOUM) = TRIM(P_CUENTA)
    FETCH FIRST 1 ROW ONLY;

    -- 3) Obtener datos del cliente
    SELECT CUNBR,
           CUNA1,
           CUCLPH,
           CUNTID,
           CUEMA1
    INTO   P_CUNBR,
           P_CUNA1,
           P_CUCLPH,
           P_CUNTID,
           P_CUEMA1
    FROM KJOELQDD.CUP00301
    WHERE TRIM(CUNBR) = TRIM(V_CIFMMM)
    FETCH FIRST 1 ROW ONLY;

END
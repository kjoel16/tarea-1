package com.mycompany.logwriter;

import java.io.BufferedWriter;
import java.io.FileWriter;
import java.nio.file.Files;
import java.nio.file.Paths;
import java.time.LocalDate;
import java.time.LocalTime;
import java.time.format.DateTimeFormatter;

public class LogWriterLib {

    public static void log(String endpoint,
                           String method,
                           String requestBody,
                           String responseBody,
                           int status,
                           long timeMs) {

        try {

            String basePath = System.getProperty("user.dir") + "/logs/";
            Files.createDirectories(Paths.get(basePath));

            String date = LocalDate.now().toString();
            String hour = LocalTime.now().format(DateTimeFormatter.ofPattern("HH"));

            String filePath = basePath + "log-" + date + "-" + hour + ".txt";

            BufferedWriter writer = new BufferedWriter(
                    new FileWriter(filePath, true)
            );

            writer.write("Endpoint: " + endpoint);
            writer.newLine();
            writer.write("Method: " + method);
            writer.newLine();
            writer.write("Status: " + status);
            writer.newLine();
            writer.write("Tiempo(ms): " + timeMs);
            writer.newLine();
            writer.write("Request JSON:");
            writer.newLine();
            writer.write(requestBody);
            writer.newLine();
            writer.write("Response JSON:");
            writer.newLine();
            writer.write(responseBody);
            writer.newLine();
            writer.write("====================================================");
            writer.newLine();
            writer.flush();
            writer.close();

        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}